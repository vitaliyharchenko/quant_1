!function(e){e.fn.formset=function(s){var a=e.extend({},e.fn.formset.defaults,s),t=a.extraClasses.join(" "),r=e("#id_"+a.prefix+"-TOTAL_FORMS"),i=e("#id_"+a.prefix+"-MAX_NUM_FORMS"),d=e("#id_"+a.prefix+"-MIN_NUM_FORMS"),l="input,select,textarea,label,div",n=e(this),o=function(e,s){a.extraClasses&&(e.removeClass(t),e.addClass(a.extraClasses[s%a.extraClasses.length]))},f=function(e,s,a){var t=new RegExp(s+"-(\\d+|__prefix__)-"),r=s+"-"+a+"-";e.attr("for")&&e.attr("for",e.attr("for").replace(t,r)),e.attr("id")&&e.attr("id",e.attr("id").replace(t,r)),e.attr("name")&&e.attr("name",e.attr("name").replace(t,r))},c=function(e){return e.find(l).length>0},m=function(){return 0==i.length||""==i.val()||i.val()-r.val()>0},h=function(){return 0==d.length||""==d.val()||r.val()-d.val()>0},p=function(s){var t=e.trim(a.deleteCssClass).replace(/\s+/g,"."),i=e.trim(a.addCssClass).replace(/\s+/g,".");s.is("TR")?s.children(":last").append('<a class="'+a.deleteCssClass+'" href="javascript:void(0)">'+a.deleteText+"</a>"):s.is("UL")||s.is("OL")?s.append('<li><a class="'+a.deleteCssClass+'" href="javascript:void(0)">'+a.deleteText+"</a></li>"):s.append('<a class="'+a.deleteCssClass+'" href="javascript:void(0)">'+a.deleteText+"</a>"),h()||s.find("a."+t).hide(),s.find("a."+t).click(function(){var s,d=e(this).parents("."+a.formCssClass),n=d.find('input:hidden[id $= "-DELETE"]'),c=d.siblings("a."+i+", ."+a.formCssClass+"-add");n.length?(n.val("on"),d.hide(),s=e("."+a.formCssClass).not(":hidden")):(d.remove(),s=e("."+a.formCssClass).not(".formset-custom-template"),r.val(s.length));for(var p=0,C=s.length;p<C;p++)o(s.eq(p),p),n.length||s.eq(p).find(l).each(function(){f(e(this),a.prefix,p)});return h()||e("a."+t).each(function(){e(this).hide()}),c.is(":hidden")&&m()&&c.show(),a.removed&&a.removed(d),!1})};if(n.each(function(s){var t=e(this),r=t.find('input:checkbox[id $= "-DELETE"]');r.length&&(r.is(":checked")?(r.before('<input type="hidden" name="'+r.attr("name")+'" id="'+r.attr("id")+'" value="on" />'),t.hide()):r.before('<input type="hidden" name="'+r.attr("name")+'" id="'+r.attr("id")+'" />'),e('label[for="'+r.attr("id")+'"]').hide(),r.remove()),c(t)&&(t.addClass(a.formCssClass),t.is(":visible")&&(p(t),o(t,s)))}),n.length){var C,v,u=!m();if(a.formTemplate?(v=a.formTemplate instanceof e?a.formTemplate:e(a.formTemplate),v.removeAttr("id").addClass(a.formCssClass+" formset-custom-template"),v.find(l).each(function(){f(e(this),a.prefix,"__prefix__")}),p(v)):(v=e("."+a.formCssClass+":last").clone(!0).removeAttr("id"),v.find('input:hidden[id $= "-DELETE"]').remove(),v.find(l).not(a.keepFieldValues).each(function(){var s=e(this);s.is("input:checkbox")||s.is("input:radio")?s.attr("checked",!1):s.val("")})),a.formTemplate=v,n.is("TR")){var x=n.eq(0).children().length,T=e('<tr><td colspan="'+x+'"><a class="'+a.addCssClass+'" href="javascript:void(0)">'+a.addText+"</a></tr>").addClass(a.formCssClass+"-add");n.parent().append(T),u&&T.hide(),C=T.find("a")}else n.filter(":last").after('<a class="'+a.addCssClass+'" href="javascript:void(0)">'+a.addText+"</a>"),C=n.filter(":last").next(),u&&C.hide();C.click(function(){var s=parseInt(r.val()),t=a.formTemplate.clone(!0).removeClass("formset-custom-template"),i=e(e(this).parents("tr."+a.formCssClass+"-add").get(0)||this);return delCssSelector=e.trim(a.deleteCssClass).replace(/\s+/g,"."),o(t,s),t.insertBefore(i).show(),t.find(l).each(function(){f(e(this),a.prefix,s)}),r.val(s+1),h()&&e("a."+delCssSelector).each(function(){e(this).show()}),m()||i.hide(),a.added&&a.added(t),!1})}return n},e.fn.formset.defaults={prefix:"form",formTemplate:null,addText:"add another",deleteText:"remove",addCssClass:"add-row",deleteCssClass:"delete-row",formCssClass:"dynamic-form",extraClasses:[],keepFieldValues:"",added:null,removed:null}}(jQuery);